<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Vietnam Trip Dec 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chosen Palette: Warm Neutrals & Tropical Accents -->
    <!-- Primary Background: #FAF9F6 (Off White) -->
    <!-- Text: #1F2937 (Gray 800) -->
    <!-- Accent HCMC: #7E22CE (Purple 700 - Royal) -->
    <!-- Accent Da Nang: #0891B2 (Cyan 600 - Ocean) -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #FAF9F6;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        /* Hide scrollbar for horizontal scrolling elements */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .btn-map {
            transition: all 0.2s;
        }
        .btn-map:active {
            transform: scale(0.95);
        }
        .filter-btn {
            transition: all 0.2s;
        }
        /* Pulse animation for the live indicator */
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; }
            100% { transform: scale(2); opacity: 0; }
        }
        .live-dot {
            position: relative;
        }
        .live-dot::before {
            content: '';
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: inherit;
            border-radius: 50%;
            z-index: -1;
            animation: pulse-ring 2s infinite;
        }
        
        /* Closed state styling */
        .card-closed {
            filter: grayscale(100%);
            opacity: 0.6;
        }
        .card-closed:hover {
            filter: grayscale(0%);
            opacity: 1;
        }
        
        /* Remove number input spinner */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="text-gray-800 antialiased pb-20">

    <!-- Navigation / Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="bg-purple-600 text-white p-2 rounded-lg">
                    <i class="fas fa-plane-departure"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">Vietnam 2025</h1>
                    <p class="text-xs text-gray-500">10 Adults ‚Ä¢ 2 Kids</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xs font-semibold text-cyan-600 bg-cyan-50 px-2 py-1 rounded-full">
                    Dec 20 - 28
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-4xl mx-auto px-4 py-6 space-y-6">

        <!-- Currency Calculator Section -->
        <section class="bg-white p-5 rounded-2xl shadow-md border-2 border-purple-300 mb-2 transform transition-all hover:shadow-lg">
            <div class="flex justify-between items-center gap-6">
                <!-- Input Side -->
                <div class="flex-1 relative">
                    <label class="block text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-1">Vietnam Dong (k)</label>
                    <div class="relative flex items-baseline">
                        <input type="number" id="vndInput" placeholder="50" inputmode="numeric" class="w-full text-3xl font-bold text-gray-800 border-b-2 border-purple-200 focus:border-purple-600 outline-none py-1 bg-transparent placeholder-gray-300 transition-colors" oninput="convertCurrency()">
                        <span class="text-lg text-gray-400 font-medium absolute right-0 bottom-2 pointer-events-none">.000</span>
                    </div>
                </div>
                
                <!-- Icon -->
                <div class="text-purple-400">
                    <i class="fas fa-exchange-alt text-xl"></i>
                </div>

                <!-- Output Side -->
                <div class="flex-1 text-right">
                    <label class="block text-[10px] text-gray-500 font-bold uppercase tracking-wider mb-1">Singapore Dollar</label>
                    <div class="text-3xl font-bold text-purple-700 py-1 border-b-2 border-transparent">
                        $<span id="sgdOutput">0.00</span>
                    </div>
                </div>
            </div>
            <p class="text-[10px] text-gray-500 mt-3 w-full text-center border-t border-purple-100 pt-2 font-medium">
                Rate: 1 SGD ‚âà 20,439.67 VND
            </p>
        </section>

        <!-- Collapsible Logistics Hub (First & Collapsed) -->
        <section id="logisticsSection">
            <button onclick="toggleLogistics()" class="w-full flex items-center justify-between bg-white p-4 rounded-xl shadow-md border-2 border-gray-300 mb-2 focus:outline-none hover:bg-gray-50 transition">
                <div class="flex items-center space-x-3">
                    <div class="bg-gray-200 p-2 rounded-lg text-gray-700">
                        <i class="fas fa-passport"></i>
                    </div>
                    <div class="text-left">
                        <h3 class="font-bold text-gray-800 text-sm">Trip Logistics & Addresses</h3>
                        <p class="text-xs text-gray-500">Flights, Airbnbs & Maps</p>
                    </div>
                </div>
                <i id="logisticsIcon" class="fas fa-chevron-up text-gray-400 transition-transform duration-300 rotate-180"></i>
            </button>

            <div id="logisticsContent" class="grid grid-cols-1 md:grid-cols-2 gap-4 transition-all duration-300 origin-top hidden">
                <!-- HCMC Logistics -->
                <div class="bg-white p-5 rounded-xl shadow-sm border-l-4 border-purple-500">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg text-purple-700">üìç Ho Chi Minh City</h3>
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Dec 20-23</span>
                    </div>
                    <div class="space-y-4">
                        <!-- Accommodation -->
                        <div class="bg-gray-50 p-3 rounded-lg relative group">
                            <p class="text-xs text-gray-500 uppercase font-semibold">Accommodation</p>
                            <p class="font-medium text-sm mt-1">38 Dinh Tien Hoang, Da Kao, District 1</p>
                            <div class="flex space-x-2 mt-2">
                                <button onclick="copyText('38 Dinh Tien Hoang, Ho Chi Minh')" class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded text-gray-600"><i class="far fa-copy mr-1"></i> Copy</button>
                                <a href="https://www.google.com/maps/search/?api=1&query=38+Dinh+Tien+Hoang+District+1+Ho+Chi+Minh" target="_blank" class="text-xs bg-purple-100 hover:bg-purple-200 text-purple-800 px-2 py-1 rounded"><i class="fas fa-map-marker-alt mr-1"></i> Map</a>
                            </div>
                        </div>
                        
                        <!-- Arrival Flight Card -->
                        <div class="bg-purple-50 p-3 rounded-lg border border-purple-100">
                             <div class="flex justify-between items-start">
                                <p class="text-xs text-purple-800 uppercase font-bold"><i class="fas fa-plane-arrival mr-1"></i> ARRIVAL: SQ 184</p>
                                <span class="text-xs text-purple-700 bg-white px-1.5 rounded border border-purple-100">Dec 20</span>
                             </div>
                             <div class="flex justify-between items-center mt-2 text-sm">
                                <div class="text-center">
                                    <span class="block font-bold text-gray-800 text-base">1:50 PM</span>
                                    <span class="text-xs text-gray-500 bg-white px-1 rounded">SIN (T2)</span>
                                </div>
                                <div class="text-purple-400 text-xs flex flex-col items-center">
                                    <span class="text-[10px] text-purple-700 font-semibold mb-0.5">Singapore Air</span>
                                    <i class="fas fa-long-arrow-alt-right text-lg"></i>
                                </div>
                                <div class="text-center">
                                    <span class="block font-bold text-gray-800 text-base">3:00 PM</span>
                                    <span class="text-xs text-gray-500 bg-white px-1 rounded">SGN (T2)</span>
                                </div>
                             </div>
                        </div>

                        <!-- Domestic Flight Card -->
                         <div class="bg-purple-50 p-3 rounded-lg border border-purple-100">
                            <div class="flex justify-between items-start">
                               <p class="text-xs text-purple-800 uppercase font-bold"><i class="fas fa-plane mr-1"></i> DOMESTIC: VN 132</p>
                               <span class="text-xs text-purple-700 bg-white px-1.5 rounded border border-purple-100">Dec 23</span>
                            </div>
                            <div class="flex justify-between items-center mt-2 text-sm">
                                <div class="text-center">
                                    <span class="block font-bold text-gray-800 text-base">1:25 PM</span>
                                    <span class="text-xs text-gray-500 bg-white px-1 rounded">SGN (T1)</span>
                                </div>
                                <div class="text-purple-400 text-xs flex flex-col items-center">
                                    <span class="text-[10px] text-purple-700 font-semibold mb-0.5">Vietnam Air</span>
                                    <i class="fas fa-long-arrow-alt-right text-lg"></i>
                                </div>
                                <div class="text-center">
                                    <span class="block font-bold text-gray-800 text-base">2:50 PM</span>
                                    <span class="text-xs text-gray-500 bg-white px-1 rounded">DAD (T1)</span>
                                </div>
                            </div>
                       </div>
                    </div>
                </div>

                <!-- Da Nang Logistics -->
                <div class="bg-white p-5 rounded-xl shadow-sm border-l-4 border-cyan-500">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg text-cyan-700">üåä Da Nang</h3>
                        <span class="text-xs bg-cyan-100 text-cyan-800 px-2 py-1 rounded">Dec 23-28</span>
                    </div>
                    <div class="space-y-4">
                        <!-- Accommodation -->
                        <div class="bg-gray-50 p-3 rounded-lg relative group">
                            <p class="text-xs text-gray-500 uppercase font-semibold">Accommodation</p>
                            <p class="font-medium text-sm mt-1">5 Phan Ba Vanh, Son Tra, Da Nang</p>
                            <div class="flex space-x-2 mt-2">
                                <button onclick="copyText('5 Phan Ba Vanh, Son Tra, Da Nang')" class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded text-gray-600"><i class="far fa-copy mr-1"></i> Copy</button>
                                <a href="https://www.google.com/maps/search/?api=1&query=5+Phan+Ba+Vanh+Son+Tra+Da+Nang" target="_blank" class="text-xs bg-cyan-100 hover:bg-cyan-200 text-cyan-800 px-2 py-1 rounded"><i class="fas fa-map-marker-alt mr-1"></i> Map</a>
                            </div>
                        </div>

                        <!-- Return Flight Card -->
                        <div class="bg-cyan-50 p-3 rounded-lg border border-cyan-100">
                            <div class="flex justify-between items-start">
                               <p class="text-xs text-cyan-800 uppercase font-bold"><i class="fas fa-plane-departure mr-1"></i> DEPARTURE: SQ 171</p>
                               <span class="text-xs text-cyan-600 bg-white px-1.5 rounded border border-cyan-100">Dec 28</span>
                            </div>
                            <div class="flex justify-between items-center mt-2 text-sm">
                                <div class="text-center">
                                    <span class="block font-bold text-gray-800 text-base">11:50 AM</span>
                                    <span class="text-xs text-gray-500 bg-white px-1 rounded">DAD (T2)</span>
                                </div>
                                <div class="text-cyan-300 text-xs flex flex-col items-center">
                                    <span class="text-[10px] text-cyan-600 font-semibold mb-0.5">Singapore Air</span>
                                    <i class="fas fa-long-arrow-alt-right text-lg"></i>
                                </div>
                                <div class="text-center">
                                    <span class="block font-bold text-gray-800 text-base">3:50 PM</span>
                                    <span class="text-xs text-gray-500 bg-white px-1 rounded">SIN (T2)</span>
                                </div>
                            </div>
                       </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Up Next Live Dashboard (Second) -->
        <section id="upNextBlock" class="bg-gradient-to-r from-gray-900 to-gray-800 p-5 rounded-xl border border-gray-700 text-white shadow-lg relative overflow-hidden">
            <div class="flex items-center space-x-2 mb-2">
                <span class="live-dot w-2 h-2 bg-green-500 rounded-full inline-block"></span>
                <p class="text-xs font-bold uppercase tracking-widest text-gray-400">Up Next On Your Schedule</p>
            </div>
            
            <div id="upNextContent">
                <!-- Javascript will populate this -->
                <div class="animate-pulse flex space-x-4">
                    <div class="flex-1 space-y-2 py-1">
                        <div class="h-4 bg-gray-700 rounded w-3/4"></div>
                        <div class="h-4 bg-gray-700 rounded w-1/2"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Itinerary Section -->
        <section id="itinerary" class="space-y-4">
            <div class="flex items-center justify-between">
                <h3 class="text-xl font-bold text-gray-800">Daily Itinerary</h3>
                <span class="text-xs text-gray-500">Tap days to view details</span>
            </div>

            <!-- Date Tabs -->
            <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-2" id="dayTabs">
                <!-- Injected via JS -->
            </div>

            <!-- Timeline Container -->
            <div id="timelineContent" class="bg-white rounded-xl shadow-sm p-5 min-h-[300px]">
                <!-- Content injected via JS -->
            </div>
        </section>

        <!-- Recommendations Explorer -->
        <section id="explorer" class="space-y-4">
            <div>
                <h3 class="text-xl font-bold text-gray-800">Activity & Food Explorer</h3>
                <p class="text-sm text-gray-500">Filter by city and category to find the perfect spot.</p>
            </div>

            <div class="flex flex-col gap-3 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                <!-- City Filter Row -->
                <div class="flex items-center space-x-2 overflow-x-auto no-scrollbar">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider mr-2">Region:</span>
                    <button onclick="setCityFilter('all')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition city-filter bg-gray-800 text-white border-gray-800" data-val="all">All Locations</button>
                    <button onclick="setCityFilter('hcmc')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition city-filter bg-white text-gray-600 border-gray-200 hover:bg-purple-50 hover:border-purple-200 hover:text-purple-700" data-val="hcmc">HCMC</button>
                    <button onclick="setCityFilter('danang')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition city-filter bg-white text-gray-600 border-gray-200 hover:bg-cyan-50 hover:border-cyan-200 hover:text-cyan-700" data-val="danang">Da Nang</button>
                </div>

                <!-- Type Filter Row -->
                <div class="flex items-center space-x-2 overflow-x-auto no-scrollbar">
                    <span class="text-xs font-bold text-gray-400 uppercase tracking-wider mr-2">Category:</span>
                    <button onclick="setTypeFilter('all')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition type-filter bg-gray-200 text-gray-800 border-gray-300" data-val="all">All</button>
                    <button onclick="setTypeFilter('food')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition type-filter bg-white text-gray-600 border-gray-200 hover:bg-orange-50 hover:text-orange-700" data-val="food">Food</button>
                    <button onclick="setTypeFilter('activity')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition type-filter bg-white text-gray-600 border-gray-200 hover:bg-blue-50 hover:text-blue-700" data-val="activity">Activities</button>
                    <button onclick="setTypeFilter('shopping')" class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border transition type-filter bg-white text-gray-600 border-gray-200 hover:bg-pink-50 hover:text-pink-700" data-val="shopping">Shopping</button>
                </div>
            </div>

            <div id="recommendationsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Populated by JS -->
            </div>
        </section>

    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-5 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full text-sm shadow-lg opacity-0 transition-opacity duration-300 pointer-events-none z-50">
        Copied to clipboard!
    </div>

    <!-- JavaScript Application Logic -->
    <script>
        // --- DATA STORE ---

        const itineraryData = [
            {
                date: "Dec 20",
                day: "Sat",
                city: "HCMC",
                color: "purple",
                events: [
                    { 
                        time: "1:50 PM", 
                        title: "Depart Singapore (SQ 184)", 
                        desc: ["Changi Airport Terminal 2"] 
                    },
                    { 
                        time: "3:00 PM", 
                        title: "Land at SGN Airport", 
                        desc: ["Land at SGN Terminal 2", "Clear immigration", "Book two 7-seater Grabs"] 
                    },
                    { 
                        time: "5:30 PM", 
                        title: "Check-in Airbnb", 
                        desc: ["38 Dinh Tien Hoang", "Check-in & Freshen up"] 
                    },
                    { 
                        time: "7:00 PM", 
                        title: "Man Moi (Tao Dan)", 
                        isBooked: true, 
                        hours: "Daily: 11:00 - 23:00",
                        address: "34 Vo Van Tan, Phuong 6, Quan 3",
                        mapLink: "https://www.google.com/maps?q=M·∫∑n+M√≤i,+Tao+ƒê√†n+-+34+V√µ+VƒÉn+T·∫ßn,+34+V√µ+VƒÉn+T·∫ßn,+Ph∆∞·ªùng+6,+Qu·∫≠n+3,+Th√†nh+ph·ªë+H·ªì+Ch√≠+Minh+70000,+Vietnam&ftid=0x31752f45e3ba9d6d:0x2b118e6c5816cfc0&entry=gps",
                        desc: ["Modern Vietnamese bistro", "~20 min Grab from Airbnb"] 
                    },
                    { 
                        time: "9:00 PM", 
                        title: "Nguyen Hue Walking Street", 
                        hours: "Open 24/7 (Best at night)",
                        address: "Nguyen Hue, District 1, HCMC",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Nguyen+Hue+Walking+Street",
                        desc: ["~15 min Grab from Man Moi", "Best vibes until 11 PM", "See: City Hall & Cafe Apartment 42", "Great for walking (no street food)", "Return: ~10 min Grab to Airbnb"] 
                    }
                ]
            },
            {
                date: "Dec 21",
                day: "Sun",
                city: "HCMC",
                color: "purple",
                events: [
                    { 
                        time: "8:00 AM", 
                        title: "Cu Chi Tunnels Tour", 
                        hours: "Daily: 07:00 - 17:00",
                        address: "Phu Hiep, Cu Chi, HCMC",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Cu+Chi+Tunnels",
                        desc: ["Half-day private tour", "Wear bug spray"] 
                    },
                    { 
                        time: "1:00 PM", 
                        title: "Lunch: Secret Garden", 
                        hours: "Daily: 11:00 - 22:00",
                        address: "158 Pasteur, Ben Nghe, District 1",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Secret+Garden+Restaurant+158+Pasteur",
                        desc: ["Rooftop home-cooked style", "Walk up stairs (no elevator)"] 
                    },
                    { 
                        time: "3:00 PM", 
                        title: "Artinus 3D Art Museum", 
                        hours: "Wknd: 09:00 - 20:00",
                        address: "02-04 Road 9, Him Lam, District 7",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Artinus+3D+Art+Museum",
                        desc: ["Great for kids (9 & 11)", "Funny 3D photos", "Indoor & AC cooled"] 
                    },
                    { 
                        time: "7:00 PM", 
                        title: "Ben Thanh Night Market", 
                        hours: "Daily: 18:00 - 24:00",
                        address: "Le Loi, Ben Thanh, District 1",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Ben+Thanh+Market",
                        desc: ["Street food dinner", "Good for souvenirs", "Watch your bags"] 
                    }
                ]
            },
            {
                date: "Dec 22",
                day: "Mon",
                city: "HCMC",
                color: "purple",
                events: [
                    { 
                        time: "9:00 AM", 
                        title: "Independence Palace", 
                        hours: "Daily: 08:00 - 15:30",
                        address: "135 Nam Ky Khoi Nghia, District 1",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Independence+Palace+Ho+Chi+Minh",
                        desc: ["Historical landmark", "Walk to Post Office"] 
                    },
                    { 
                        time: "12:00 PM", 
                        title: "Lunch: Pho Hoa Pasteur", 
                        hours: "Daily: 06:00 - 22:30",
                        address: "260C Pasteur, District 3",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Pho+Hoa+Pasteur",
                        desc: ["Top rated Pho spot"] 
                    },
                    { 
                        time: "2:00 PM", 
                        title: "Shopping: Saigon Centre", 
                        hours: "Daily: 09:30 - 21:30",
                        address: "65 Le Loi, Ben Nghe, District 1",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Saigon+Centre",
                        desc: ["Takashimaya (High-end)", "AC break from heat"] 
                    },
                    { 
                        time: "6:00 PM", 
                        title: "Saigon River Dinner Cruise", 
                        hours: "Starts: 18:00",
                        address: "5 Nguyen Tat Thanh, District 4 (Check Ticket)",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Saigon+River+Cruise+Port",
                        desc: ["Book via Klook/Trip.com", "Dinner with views"] 
                    }
                ]
            },
            {
                date: "Dec 23",
                day: "Tue",
                city: "Transit",
                color: "red",
                events: [
                    { time: "10:15 AM", title: "Leave Airbnb", desc: ["Go to SGN Domestic T1"] },
                    { time: "1:25 PM", title: "Depart HCMC (VN 132)", desc: ["Vietnam Airlines (T1)", "Flight duration: ~1h 25m"] },
                    { time: "2:50 PM", title: "Land in Da Nang", desc: ["Land DAD Terminal 1", "Grab to Son Tra Airbnb"] },
                    { 
                        time: "7:30 PM", 
                        title: "Pizza 4P's Indochina", 
                        isBooked: true, 
                        hours: "Daily: 11:00 - 22:00",
                        address: "74 Bach Dang, Hai Chau, Da Nang",
                        mapLink: "https://www.google.com/maps?q=Pizza+4P%27s+Indochina+Da+Nang,+74+B·∫°ch+ƒê·∫±ng,+Street,+H·∫£i+Ch√¢u,+ƒê√†+N·∫µng+550000,+Vietnam&ftid=0x3142193cf50bef09:0x6f1b1de8e432c22e&entry=gps",
                        desc: ["Riverside View", "~15 min Grab"] 
                    }
                ]
            },
            {
                date: "Dec 24",
                day: "Wed",
                city: "Da Nang",
                color: "cyan",
                events: [
                    { 
                        time: "9:00 AM", 
                        title: "Pink Cathedral & Han Market", 
                        hours: "Market Daily: 06:00 - 19:00",
                        address: "156 Tran Phu, Hai Chau, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Da+Nang+Cathedral",
                        desc: ["Famous Pink Church", "Shop at Han Market nearby"] 
                    },
                    { 
                        time: "12:00 PM", 
                        title: "Lunch: Banh Xeo Ba Duong", 
                        hours: "Daily: 09:00 - 21:30",
                        address: "K280/23 Hoang Dieu, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Banh+Xeo+Ba+Duong",
                        desc: ["Savory pancakes (Banh Xeo)", "Fun DIY rolling"] 
                    },
                    { 
                        time: "2:00 PM", 
                        title: "My Khe Beach", 
                        hours: "Public Access",
                        address: "Vo Nguyen Giap Street, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=My+Khe+Beach",
                        desc: ["Relax by the sea", "Soft sand, kid-friendly"] 
                    },
                    { 
                        time: "7:00 PM", 
                        title: "Xmas Eve: Madame Lan", 
                        hours: "Daily: 06:30 - 21:30",
                        address: "4 Bach Dang, Hai Chau, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Madame+Lan+Restaurant",
                        desc: ["Beautiful courtyard", "Reserve ahead!"] 
                    }
                ]
            },
            {
                date: "Dec 25",
                day: "Thu",
                city: "Hoi An",
                color: "cyan",
                events: [
                    { 
                        time: "10:00 AM", 
                        title: "Marble Mountains", 
                        hours: "Daily: 07:00 - 17:30",
                        address: "81 Huyen Tran Cong Chua, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Marble+Mountains+Da+Nang",
                        desc: ["Caves & Pagodas", "Use the elevator"] 
                    },
                    { 
                        time: "2:00 PM", 
                        title: "Hoi An Ancient Town", 
                        hours: "Open Daily",
                        address: "Hoi An, Quang Nam",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Hoi+An+Ancient+Town",
                        desc: ["30 min drive", "Pedestrian only zone"] 
                    },
                    { 
                        time: "5:00 PM", 
                        title: "Lantern Boat Ride", 
                        hours: "Best: 17:00 - 21:00",
                        address: "Bach Dang Street, Hoi An",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Hoi+An+Lantern+Boat",
                        desc: ["Thu Bon River", "Release Xmas lantern"] 
                    },
                    { 
                        time: "8:00 PM", 
                        title: "Hoi An Night Market", 
                        hours: "Daily: 17:00 - 22:00",
                        address: "Nguyen Hoang Street, Hoi An",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Hoi+An+Night+Market",
                        desc: ["Souvenir shopping", "Return to Da Nang"] 
                    }
                ]
            },
            {
                date: "Dec 26",
                day: "Fri",
                city: "Da Nang",
                color: "cyan",
                events: [
                    { 
                        time: "10:00 AM", 
                        title: "Coffee Making Workshop", 
                        isBooked: true, 
                        address: "Check Booking Confirmation",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Coffee+Workshop+Da+Nang",
                        desc: ["Learn Vietnamese coffee", "~15 min Grab to center"] 
                    },
                    { 
                        time: "12:30 PM", 
                        title: "Lunch: Mi Quang 1A", 
                        hours: "Daily: 06:00 - 21:00",
                        address: "1A Hai Phong, Hai Chau, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Mi+Quang+1A",
                        desc: ["Famous local noodle dish"] 
                    },
                    { 
                        time: "2:30 PM", 
                        title: "Son Tra Peninsula", 
                        hours: "Daily: 06:00 - 21:00",
                        address: "Linh Ung Pagoda, Son Tra",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Linh+Ung+Pagoda+Son+Tra",
                        desc: ["Visit Lady Buddha", "Watch for monkeys"] 
                    },
                    { 
                        time: "6:00 PM", 
                        title: "Helio Night Market", 
                        hours: "Daily: 17:30 - 22:30",
                        address: "2/9 Street, Hai Chau, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Helio+Night+Market",
                        desc: ["Modern & clean", "Live music & games"] 
                    }
                ]
            },
            {
                date: "Dec 27",
                day: "Sat",
                city: "Da Nang",
                color: "cyan",
                events: [
                    { time: "8:30 AM", title: "Depart for Ba Na Hills", desc: ["~45-60 min drive", "Book round trip transport"] },
                    { 
                        time: "9:30 AM", 
                        title: "Ba Na Hills", 
                        isBooked: true, 
                        hours: "Daily: 07:00 - 22:00",
                        address: "Hoa Ninh, Hoa Vang, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Sun+World+Ba+Na+Hills",
                        desc: ["Cable Car & Golden Bridge", "French Village & Coaster", "Buffet Lunch included"] 
                    },
                    { time: "5:00 PM", title: "Return to Da Nang", desc: ["Rest at Airbnb"] },
                    { 
                        time: "9:00 PM", 
                        title: "Dragon Bridge Fire Show", 
                        hours: "Sat/Sun @ 21:00",
                        address: "Dragon Bridge, Da Nang",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Dragon+Bridge+Da+Nang",
                        desc: ["Sat/Sun at 9pm", "Head to bridge head"] 
                    }
                ]
            },
            {
                date: "Dec 28",
                day: "Sun",
                city: "Home",
                color: "gray",
                events: [
                    { time: "9:30 AM", title: "Checkout & Leave", desc: ["Go to DAD Intl Terminal 2"] },
                    { time: "11:50 AM", title: "Depart Da Nang (SQ 171)", desc: ["Singapore Airlines (T2)"] },
                    { time: "3:50 PM", title: "Land in Singapore", desc: ["Land Changi T2"] }
                ]
            }
        ];

        const recData = [
            // HCMC - FOOD
            { 
                title: "Banh Mi Huynh Hoa", 
                type: "food", 
                city: "HCMC", 
                rating: 4.3, 
                reviews: "25k+",
                address: "26 Le Thi Rieng, Ben Thanh",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Banh+Mi+Huynh+Hoa",
                image: "https://images.unsplash.com/photo-1600271886742-f049cd451bba?auto=format&fit=crop&w=600&q=80",
                points: ["Famous meat-heavy Banh Mi", "Takeaway only", "Best before 6PM"],
                hoursDisplay: "Daily, 11:00 - 21:00",
                openTime: 11, closeTime: 21
            },
            { 
                title: "Cuc Gach Quan", 
                type: "food", 
                city: "HCMC", 
                rating: 4.3, 
                reviews: "3.8k",
                address: "10 Dang Tat, Tan Dinh",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Cuc+Gach+Quan",
                image: "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=600&q=80",
                points: ["Rustic country style food", "Architect-designed house", "Celebrity favorite"],
                hoursDisplay: "Daily, 09:00 - 23:00",
                openTime: 9, closeTime: 23
            },
            { 
                title: "Hum Vegetarian", 
                type: "food", 
                city: "HCMC", 
                rating: 4.6, 
                reviews: "2.5k",
                address: "32 Vo Van Tan, District 3",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Hum+Vegetarian",
                image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?auto=format&fit=crop&w=600&q=80",
                points: ["Upscale vegetarian", "Peaceful garden vibes", "Great cocktails/drinks"],
                hoursDisplay: "Daily, 10:00 - 22:00",
                openTime: 10, closeTime: 22
            },
            { 
                title: "Quan An Ngon 138", 
                type: "food", 
                city: "HCMC", 
                rating: 4.2, 
                reviews: "8.2k",
                address: "138 Nam Ky Khoi Nghia",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Quan+An+Ngon+138",
                image: "https://images.unsplash.com/photo-1555939594-58d7cb561ad1?auto=format&fit=crop&w=600&q=80",
                points: ["Huge variety menu", "Street food style safely", "Good for large groups"],
                hoursDisplay: "Daily, 07:00 - 22:00",
                openTime: 7, closeTime: 22
            },
            { 
                title: "Secret Garden", 
                type: "food", 
                city: "HCMC", 
                rating: 4.4, 
                reviews: "3.2k",
                address: "158 Pasteur, District 1",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Secret+Garden+Restaurant+HCMC",
                image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?auto=format&fit=crop&w=600&q=80",
                points: ["Rooftop garden", "Home-cooked meals", "No elevator (4 floors)"],
                hoursDisplay: "Daily, 11:00 - 22:00",
                openTime: 11, closeTime: 22
            },
            { 
                title: "Phuc Long Coffee & Tea", 
                type: "food", 
                city: "HCMC", 
                rating: 4.5, 
                reviews: "Many",
                address: "Various Locations",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Phuc+Long+Coffee+and+Tea",
                image: "https://images.unsplash.com/photo-1544787219-7f47ccb76574?auto=format&fit=crop&w=600&q=80",
                points: ["Famous Peach Tea", "Strong local coffee", "Multiple branches"],
                hoursDisplay: "Daily, 07:00 - 22:30",
                openTime: 7, closeTime: 22.5
            },

            // HCMC - SHOPPING
            { 
                title: "Vincom Center", 
                type: "shopping", 
                city: "HCMC", 
                rating: 4.5, 
                reviews: "15k",
                address: "72 Le Thanh Ton",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Vincom+Center+Dong+Khoi",
                image: "https://images.unsplash.com/photo-1519567241046-7f570eee3c9e?auto=format&fit=crop&w=600&q=80",
                points: ["Zara & H&M", "Basement food court", "Central location"],
                hoursDisplay: "Daily, 09:30 - 22:00",
                openTime: 9.5, closeTime: 22
            },
            { 
                title: "Crescent Mall", 
                type: "shopping", 
                city: "HCMC", 
                rating: 4.4, 
                reviews: "10k",
                address: "101 Ton Dat Tien, D7",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Crescent+Mall",
                image: "https://images.unsplash.com/photo-1567449303078-5c942454256c?auto=format&fit=crop&w=600&q=80",
                points: ["Near Starlight Bridge", "Very spacious", "Kid-friendly zones"],
                hoursDisplay: "Daily, 10:00 - 22:00",
                openTime: 10, closeTime: 22
            },
            { 
                title: "Ben Thanh Market", 
                type: "shopping", 
                city: "HCMC", 
                rating: 4.0, 
                reviews: "35k",
                address: "Le Loi, Ben Thanh",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Ben+Thanh+Market",
                image: "https://images.unsplash.com/photo-1583417319070-4a69db38a482?auto=format&fit=crop&w=600&q=80",
                points: ["Must Buy: Lacquerware & Art", "Souvenirs & fabric", "Must bargain hard"],
                hoursDisplay: "Daily, 06:00 - 18:00",
                openTime: 6, closeTime: 18
            },
            { 
                title: "Takashimaya (Saigon Centre)", 
                type: "shopping", 
                city: "HCMC", 
                rating: 4.6, 
                reviews: "18k",
                address: "65 Le Loi, District 1",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Takashimaya+Vietnam",
                image: "https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&w=600&q=80",
                points: ["High-end Japanese brands", "Amazing basement food", "Clean & modern"],
                hoursDisplay: "Daily, 09:30 - 21:30",
                openTime: 9.5, closeTime: 21.5
            },

            // HCMC - ACTIVITIES
            { 
                title: "Golden Dragon Water Puppet", 
                type: "activity", 
                city: "HCMC", 
                rating: 4.2, 
                reviews: "1.5k",
                address: "55B Nguyen Thi Minh Khai",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Golden+Dragon+Water+Puppet+Theatre",
                image: "https://images.unsplash.com/photo-1535914254981-40b3b3c7e39a?auto=format&fit=crop&w=600&q=80",
                points: ["50-min show", "Live traditional music", "Unique cultural art"],
                hoursDisplay: "Daily shows ~17:00",
                openTime: 8, closeTime: 20
            },
            { 
                title: "Saigon Zoo & Botanical Gardens", 
                type: "activity", 
                city: "HCMC", 
                rating: 4.2, 
                reviews: "22k",
                address: "2 Nguyen Binh Khiem",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Saigon+Zoo+and+Botanical+Gardens",
                image: "https://images.unsplash.com/photo-1534567176755-26962353138f?auto=format&fit=crop&w=600&q=80",
                points: ["Oldest zoo in Asia", "Great for morning walks", "Cheap entry ticket"],
                hoursDisplay: "Daily, 07:00 - 17:30",
                openTime: 7, closeTime: 17.5
            },

            // DA NANG - FOOD
            { 
                title: "Banh Xeo Ba Duong", 
                type: "food", 
                city: "Da Nang", 
                rating: 4.1, 
                reviews: "8.5k",
                address: "K280/23 Hoang Dieu",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Banh+Xeo+Ba+Duong",
                image: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=600&q=80",
                points: ["Savory pancakes", "Hidden alley gem", "Fun DIY rolling"],
                hoursDisplay: "Daily, 09:00 - 21:30",
                openTime: 9, closeTime: 21.5
            },
            { 
                title: "My Quang Ech Bep Trang", 
                type: "food", 
                city: "Da Nang", 
                rating: 4.0, 
                reviews: "2k",
                address: "441 Ong Ich Khiem",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Bep+Trang+My+Quang",
                image: "https://images.unsplash.com/photo-1631705607062-c0e81792440e?auto=format&fit=crop&w=600&q=80",
                points: ["Frog noodles specialty", "Bold flavors", "Local experience"],
                hoursDisplay: "Daily, 06:30 - 22:00",
                openTime: 6.5, closeTime: 22
            },
            { 
                title: "Hai San Nam Danh", 
                type: "food", 
                city: "Da Nang", 
                rating: 4.3, 
                reviews: "4k",
                address: "K139/H59/38 Tran Quang Khai",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Hai+San+Nam+Danh",
                image: "https://images.unsplash.com/photo-1534604973900-c43ab4c2e0ab?auto=format&fit=crop&w=600&q=80",
                points: ["Very cheap seafood", "Deep in alley maze", "Always crowded"],
                hoursDisplay: "Daily, 10:00 - 20:00",
                openTime: 10, closeTime: 20
            },
            { 
                title: "Madam Khanh - Banh Mi Queen", 
                type: "food", 
                city: "Hoi An", 
                rating: 4.5, 
                reviews: "5k",
                address: "115 Tran Cao Van, Hoi An",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Madam+Khanh+The+Banh+Mi+Queen",
                image: "https://images.unsplash.com/photo-1600271886742-f049cd451bba?auto=format&fit=crop&w=600&q=80",
                points: ["Legendary Banh Mi", "Crispy bread", "Secret sauce"],
                hoursDisplay: "Daily, 06:30 - 19:30",
                openTime: 6.5, closeTime: 19.5
            },
            { 
                title: "Cong Caphe (Han Market)", 
                type: "food", 
                city: "Da Nang", 
                rating: 4.5, 
                reviews: "5.1k",
                address: "98-96 Bach Dang",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Cong+Caphe+Bach+Dang+Da+Nang",
                image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=600&q=80",
                points: ["Coconut Coffee slushy", "Communist chic decor", "Riverside view"],
                hoursDisplay: "Daily, 07:00 - 23:00",
                openTime: 7, closeTime: 23
            },

            // DA NANG - SHOPPING
            { 
                title: "Lotte Mart", 
                type: "shopping", 
                city: "Da Nang", 
                rating: 4.4, 
                reviews: "12k",
                address: "6 Nai Nam, Hai Chau",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Lotte+Mart+Da+Nang",
                image: "https://images.unsplash.com/photo-1578916171728-46686eac8d58?auto=format&fit=crop&w=600&q=80",
                points: ["Must Buy: Cashews & Coffee", "Bowling & Cinema", "Good souvenir snacks"],
                hoursDisplay: "Daily, 08:00 - 22:00",
                openTime: 8, closeTime: 22
            },
            { 
                title: "Han Market", 
                type: "shopping", 
                city: "Da Nang", 
                rating: 4.0, 
                reviews: "18k",
                address: "119 Tran Phu, Hai Chau 1",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Han+Market+Da+Nang",
                image: "https://images.unsplash.com/photo-1533900298318-6b8da08a523e?auto=format&fit=crop&w=600&q=80",
                points: ["Must Buy: Rattan Bags", "Dried fruits/coffee", "Central location"],
                hoursDisplay: "Daily, 06:00 - 19:00",
                openTime: 6, closeTime: 19
            },
            { 
                title: "Vincom Plaza Da Nang", 
                type: "shopping", 
                city: "Da Nang", 
                rating: 4.3, 
                reviews: "8k",
                address: "910A Ngo Quyen",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Vincom+Plaza+Ngo+Quyen",
                image: "https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&w=600&q=80",
                points: ["Ice rink", "Cinema", "Jollibee/Highlands"],
                hoursDisplay: "Daily, 09:30 - 22:00",
                openTime: 9.5, closeTime: 22
            },
            { 
                title: "Go! (Big C) Da Nang", 
                type: "shopping", 
                city: "Da Nang", 
                rating: 4.2, 
                reviews: "11k",
                address: "257 Hung Vuong",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Big+C+Da+Nang",
                image: "https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=600&q=80",
                points: ["Must Buy: Green Bean Cake", "Coconut Candy & Spices", "Local prices"],
                hoursDisplay: "Daily, 08:00 - 22:00",
                openTime: 8, closeTime: 22
            },

            // DA NANG - ACTIVITIES
            { 
                title: "Mikazuki Water Park 365", 
                type: "activity", 
                city: "Da Nang", 
                rating: 4.6, 
                reviews: "3k",
                address: "Xuan Thieu Tourism Area",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Mikazuki+Water+Park+365",
                image: "https://images.unsplash.com/photo-1582653291997-079a1c04c792?auto=format&fit=crop&w=600&q=80",
                points: ["Indoor & Outdoor", "Hot springs", "Japanese theme"],
                hoursDisplay: "Daily, 09:00 - 19:00",
                openTime: 9, closeTime: 19
            },
            { 
                title: "Ao Dai Rental (Aobaba)", 
                type: "activity", 
                city: "Hoi An", 
                rating: 4.8, 
                reviews: "300+",
                address: "148 Tran Phu, Hoi An",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Aobaba+Hoi+An+Tailor",
                image: "https://images.unsplash.com/photo-1599708153386-51e429320294?auto=format&fit=crop&w=600&q=80",
                points: ["Family rentals", "Great for photos", "Hoi An tradition"],
                hoursDisplay: "Daily, 08:00 - 20:00",
                openTime: 8, closeTime: 20
            },
            { 
                title: "Hoi An Memories Show", 
                type: "activity", 
                city: "Hoi An", 
                rating: 4.7, 
                reviews: "2k",
                address: "Hoi An Impression Park",
                mapLink: "https://www.google.com/maps/search/?api=1&query=Hoi+An+Memories+Show",
                image: "https://images.unsplash.com/photo-1514525253440-b393452e2729?auto=format&fit=crop&w=600&q=80",
                points: ["Huge outdoor show", "Visual storytelling", "Hundreds of actors"],
                hoursDisplay: "Park open 17:00-22:00",
                openTime: 17, closeTime: 22
            },
            
            // APP
            { 
                title: "Grab App", 
                type: "activity", 
                city: "App", 
                rating: 4.8, 
                reviews: "App Store",
                address: "Download on Phone",
                mapLink: "",
                image: "https://images.unsplash.com/photo-1449965408869-eaa3f722e40d?auto=format&fit=crop&w=600&q=80",
                points: ["Essential for travel", "Link credit card", "Fixed pricing"],
                hoursDisplay: "24/7 Service",
                openTime: 0, closeTime: 24
            },
        ];

        // --- FILTER STATE ---
        let activeCity = 'all';
        let activeType = 'all';

        // --- RENDER FUNCTIONS ---

        function renderTabs(activeIndex = 0) {
            const container = document.getElementById('dayTabs');
            container.innerHTML = itineraryData.map((day, index) => `
                <button onclick="switchDay(${index})" 
                    class="flex-shrink-0 px-4 py-3 rounded-xl border transition-all duration-200 ${index === activeIndex 
                        ? `bg-${day.color}-500 text-white border-${day.color}-600 shadow-md transform scale-105` 
                        : 'bg-white text-gray-600 border-gray-200 hover:bg-gray-50'}"
                >
                    <div class="text-xs opacity-80 uppercase font-semibold">${day.date}</div>
                    <div class="font-bold text-lg leading-none mt-1">${day.day}</div>
                </button>
            `).join('');
        }

        function renderTimeline(index) {
            const data = itineraryData[index];
            const container = document.getElementById('timelineContent');
            
            let html = `
                <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-100">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">${data.date} - ${data.day}</h2>
                        <p class="text-${data.color}-600 font-medium">${data.city}</p>
                    </div>
                    <div class="text-3xl text-${data.color}-200">
                        <i class="fas ${index < 4 ? 'fa-city' : 'fa-water'}"></i>
                    </div>
                </div>
                <div class="space-y-6 relative border-l-2 border-${data.color}-100 ml-3 pl-6">
            `;

            html += data.events.map(event => {
                const mapButton = event.mapLink ? 
                    `<a href="${event.mapLink}" target="_blank" class="btn-map inline-flex items-center text-xs bg-white border border-gray-200 text-gray-600 px-2 py-1 rounded-md hover:bg-gray-50 hover:text-${data.color}-600 hover:border-${data.color}-300 mt-2 shadow-sm">
                        <i class="fas fa-location-dot mr-1.5 text-${data.color}-500"></i> View Map
                     </a>` : '';

                const addressText = event.address ? 
                    `<div class="text-xs text-gray-400 mt-1 flex items-start">
                        <i class="fas fa-map-pin mr-1.5 mt-0.5 flex-shrink-0"></i>
                        <span>${event.address}</span>
                     </div>` : '';
                
                // New logic: Green background for hours tag in itinerary timeline
                const hoursBadge = event.hours ? 
                    `<span class="text-[10px] bg-green-100 text-green-800 border border-green-200 px-2 py-0.5 rounded ml-2 whitespace-nowrap font-medium"><i class="far fa-clock mr-1"></i>${event.hours}</span>` : '';

                if (event.isBooked) {
                    // BOOKED ITEM - Green Card
                    const bookedMapBtn = event.mapLink ? 
                        `<a href="${event.mapLink}" target="_blank" class="btn-map inline-flex items-center text-xs bg-white border border-green-300 text-green-700 px-2 py-1 rounded-md hover:bg-green-50 mt-2 shadow-sm">
                            <i class="fas fa-location-dot mr-1.5 text-green-600"></i> View Map
                         </a>` : '';
                    
                    const bookedAddress = event.address ? 
                        `<div class="text-xs text-green-700/70 mt-1 flex items-start">
                            <i class="fas fa-map-pin mr-1.5 mt-0.5 flex-shrink-0"></i>
                            <span>${event.address}</span>
                         </div>` : '';
                    
                    const bookedHours = event.hours ? 
                         `<div class="text-[10px] text-green-800 font-medium mt-1 bg-green-100/50 inline-block px-1.5 py-0.5 rounded border border-green-200/50"><i class="far fa-clock mr-1"></i>${event.hours}</div>` : '';

                    return `
                        <div class="relative group">
                            <!-- Larger Timeline Dot -->
                            <div class="absolute -left-[38px] bg-green-500 h-5 w-5 rounded-full border-4 border-white shadow-sm mt-4 z-10"></div>
                            
                            <!-- Full Green Card -->
                            <div class="bg-green-50 border border-green-200 rounded-xl p-4 shadow-sm relative">
                                <div class="absolute top-0 right-0 bg-green-200 text-green-800 text-[10px] font-bold px-2 py-1 rounded-bl-lg rounded-tr-lg uppercase tracking-wider">
                                    Booked
                                </div>
                                <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-1 mb-1">
                                    <span class="font-bold text-green-700 text-sm w-24 flex-shrink-0">${event.time}</span>
                                    <div class="flex-grow">
                                        <h4 class="font-bold text-green-900 text-lg leading-tight">${event.title}</h4>
                                    </div>
                                </div>
                                <ul class="list-disc list-inside text-sm text-green-800 space-y-1">
                                    ${event.desc.map(d => `<li>${d}</li>`).join('')}
                                </ul>
                                ${bookedHours}
                                ${bookedAddress}
                                ${bookedMapBtn}
                            </div>
                        </div>
                    `;
                } else {
                    // STANDARD ITEM
                    return `
                        <div class="relative group">
                            <div class="absolute -left-[31px] bg-${data.color}-500 h-4 w-4 rounded-full border-4 border-white shadow-sm mt-1.5"></div>
                            <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-1">
                                <span class="font-bold text-${data.color}-600 text-sm w-20 flex-shrink-0">${event.time}</span>
                                <div class="flex-grow">
                                    <h4 class="font-bold text-gray-800 text-lg leading-tight inline-block">${event.title}</h4>
                                    ${hoursBadge}
                                </div>
                            </div>
                            <ul class="list-disc list-inside text-sm text-gray-600 space-y-1 mt-1 bg-gray-50 p-3 rounded-lg border border-gray-100">
                                ${event.desc.map(d => `<li>${d}</li>`).join('')}
                            </ul>
                            ${addressText}
                            ${mapButton}
                        </div>
                    `;
                }
            }).join('');

            html += `</div>`;
            container.innerHTML = html;
        }

        function switchDay(index) {
            renderTabs(index);
            renderTimeline(index);
        }

        function getCityColor(city) {
            if (city === 'HCMC') return 'bg-purple-100 text-purple-800';
            if (city === 'Da Nang' || city === 'Hoi An') return 'bg-cyan-100 text-cyan-800';
            return 'bg-gray-100 text-gray-600';
        }

        function getBorderColor(type) {
            if (type === 'food') return 'border-orange-200 hover:shadow-orange-100';
            if (type === 'activity') return 'border-blue-200 hover:shadow-blue-100';
            if (type === 'shopping') return 'border-pink-200 hover:shadow-pink-100';
            return 'border-gray-100';
        }

        function setCityFilter(city) {
            activeCity = city;
            updateFilterUI();
            renderRecommendations();
        }

        function setTypeFilter(type) {
            activeType = type;
            updateFilterUI();
            renderRecommendations();
        }

        function updateFilterUI() {
            // Update City Buttons
            document.querySelectorAll('.city-filter').forEach(btn => {
                const val = btn.dataset.val;
                if(val === activeCity) {
                    btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                    if(val === 'hcmc') btn.classList.add('bg-purple-100', 'text-purple-800', 'border-purple-200');
                    else if(val === 'danang') btn.classList.add('bg-cyan-100', 'text-cyan-800', 'border-cyan-200');
                    else btn.classList.add('bg-gray-800', 'text-white', 'border-gray-800');
                } else {
                     btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                     if(val === 'hcmc') btn.classList.remove('bg-purple-100', 'text-purple-800', 'border-purple-200');
                     else if(val === 'danang') btn.classList.remove('bg-cyan-100', 'text-cyan-800', 'border-cyan-200');
                     else btn.classList.remove('bg-gray-800', 'text-white', 'border-gray-800');
                }
            });

             // Update Type Buttons
            document.querySelectorAll('.type-filter').forEach(btn => {
                const val = btn.dataset.val;
                if(val === activeType) {
                    btn.classList.remove('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.add('bg-gray-800', 'text-white', 'border-gray-800');
                } else {
                    btn.classList.add('bg-white', 'text-gray-600', 'border-gray-200');
                    btn.classList.remove('bg-gray-800', 'text-white', 'border-gray-800');
                }
            });
        }

        function isShopOpen(item) {
            const now = new Date();
            const hour = now.getHours() + (now.getMinutes() / 60);
            
            // Handle edge case of 24/7 or late night
            if (item.closeTime < item.openTime) {
                // e.g. open 18:00 close 02:00
                return hour >= item.openTime || hour < item.closeTime;
            }
            return hour >= item.openTime && hour < item.closeTime;
        }

        function renderRecommendations() {
            const container = document.getElementById('recommendationsGrid');
            
            const filtered = recData.filter(item => {
                // City Filter Logic
                let cityMatch = false;
                if (activeCity === 'all') {
                    cityMatch = true;
                } else if (activeCity === 'hcmc') {
                    cityMatch = (item.city === 'HCMC' || item.city === 'App');
                } else if (activeCity === 'danang') {
                    cityMatch = (item.city === 'Da Nang' || item.city === 'Hoi An' || item.city === 'App');
                }
                
                // Type Filter Logic
                let typeMatch = false;
                if (activeType === 'all') {
                    typeMatch = true;
                } else {
                    typeMatch = (item.type === activeType);
                }

                return cityMatch && typeMatch;
            });
            
            if (filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-10 text-gray-400 italic">No items match these filters.</div>`;
                return;
            }

            container.innerHTML = filtered.map(item => {
                const borderClass = getBorderColor(item.type);
                const cityClass = getCityColor(item.city);
                const isOpen = isShopOpen(item);
                const contentOpacity = isOpen ? '' : 'opacity-75'; 
                const imageGrayscale = isOpen ? '' : 'grayscale';
                const statusDot = isOpen ? 'bg-green-600' : 'bg-red-500';
                
                // New logic: Vibrant green tag if open
                const hoursTagClass = isOpen 
                    ? 'bg-green-100 text-green-800 border-green-200 font-bold' 
                    : 'bg-gray-100 text-gray-500 border-gray-200 font-medium';

                return `
                <div class="bg-white rounded-xl shadow-sm border-2 ${borderClass} hover:shadow-md transition-shadow flex flex-col h-full overflow-hidden transition-all duration-300">
                    <div class="h-32 w-full relative">
                        <img src="${item.image}" class="w-full h-full object-cover ${imageGrayscale}" alt="${item.title}" onerror="this.src='https://placehold.co/600x400?text=No+Image'">
                        <span class="absolute top-2 right-2 ${cityClass} text-[10px] px-2 py-0.5 rounded-full font-bold shadow-sm uppercase tracking-wide border border-white/50">${item.city}</span>
                        ${!isOpen ? '<div class="absolute inset-0 bg-gray-900/10 flex items-center justify-center"><span class="bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg border border-red-400">CLOSED NOW</span></div>' : ''}
                    </div>
                    
                    <div class="p-4 flex flex-col flex-grow ${contentOpacity}">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-gray-800 text-lg leading-tight w-3/4">${item.title}</h4>
                            ${item.rating ? `
                            <div class="flex items-center space-x-1 bg-yellow-50 px-1.5 py-0.5 rounded border border-yellow-100">
                                <i class="fas fa-star text-yellow-400 text-[10px]"></i>
                                <span class="text-xs font-bold text-gray-700">${item.rating}</span>
                            </div>
                            ` : ''}
                        </div>

                        <ul class="text-xs text-gray-600 space-y-1 mb-4 flex-grow list-disc list-inside opacity-80">
                            ${item.points.map(p => `<li>${p}</li>`).join('')}
                        </ul>
                        
                        <div class="flex justify-between items-end mt-auto pt-3 border-t border-gray-50">
                            <div class="flex items-center text-[10px] px-2 py-1 rounded border ${hoursTagClass}">
                                <span class="w-2 h-2 ${statusDot} rounded-full mr-1.5"></span>
                                ${item.hoursDisplay}
                            </div>
                            ${item.mapLink ? `
                            <a href="${item.mapLink}" target="_blank" class="btn-map inline-flex items-center text-xs bg-white border border-gray-200 text-gray-600 px-2 py-1 rounded-md hover:bg-gray-50 hover:text-cyan-600 hover:border-cyan-300 shadow-sm transition">
                                <i class="fas fa-location-dot mr-1"></i> Map
                            </a>` : ''}
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function copyText(text) {
            // Fallback for iframe/permissions policy restrictions
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    const toast = document.getElementById('toast');
                    toast.classList.remove('opacity-0');
                    setTimeout(() => toast.classList.add('opacity-0'), 2000);
                }
            } catch (err) {
                console.error('Copy failed', err);
            }
            document.body.removeChild(textArea);
        }
        
        function convertCurrency() {
            const rate = 20439.67;
            const input = document.getElementById('vndInput').value;
            const output = document.getElementById('sgdOutput');
            
            if (input) {
                // Input is in 'k', so multiply by 1000 first
                const vnd = parseFloat(input) * 1000;
                const sgd = vnd / rate;
                output.innerText = sgd.toFixed(2);
            } else {
                output.innerText = "0.00";
            }
        }

        function updateUpNext() {
            const now = new Date();
            // FOR DEMO: If current year is NOT 2025, default to looking at Dec 20, 2025 2:00 PM for testing
            // Remove this in production if you want real-time only
            // const now = new Date("Dec 20, 2025 14:00:00"); 

            let upcomingEvents = [];

            itineraryData.forEach(day => {
                day.events.forEach(event => {
                    // Simple parse: "Dec 20" + " " + "2025" + " " + "1:50 PM"
                    // Handle time formats roughly
                    const timePart = event.time;
                    const eventDateString = `${day.date}, 2025 ${timePart}`;
                    const eventDate = new Date(eventDateString);
                    
                    if (eventDate > now) {
                        upcomingEvents.push({
                            dateObj: eventDate,
                            dayTitle: day.date,
                            ...event
                        });
                    }
                });
            });

            // Sort by time
            upcomingEvents.sort((a, b) => a.dateObj - b.dateObj);

            const container = document.getElementById('upNextContent');
            
            if (upcomingEvents.length > 0) {
                const next = upcomingEvents[0];
                const diffMs = next.dateObj - now;
                const diffHrs = Math.floor((diffMs % 86400000) / 3600000);
                const diffMins = Math.round(((diffMs % 86400000) % 3600000) / 60000);
                
                // Format nicely
                let timeString = "";
                const days = Math.floor(diffMs / 86400000);
                if (days > 0) timeString += `${days}d `;
                if (diffHrs > 0) timeString += `${diffHrs}h `;
                timeString += `${diffMins}m`;

                // Handle first point if array
                const descText = Array.isArray(next.desc) ? next.desc[0] : next.desc;

                container.innerHTML = `
                    <div class="mt-2">
                        <div class="flex justify-between items-end">
                            <h2 class="text-2xl font-bold text-white leading-tight">${next.title}</h2>
                            <span class="text-sm bg-gray-700 px-2 py-1 rounded text-gray-300 whitespace-nowrap ml-2">${next.dayTitle} @ ${next.time}</span>
                        </div>
                        <p class="text-gray-400 text-sm mt-1">${descText}</p>
                        <div class="mt-4 pt-3 border-t border-gray-700 flex items-center text-sm text-green-400 font-mono">
                            <i class="fas fa-stopwatch mr-2"></i> Starts in ${timeString}
                        </div>
                    </div>
                `;
            } else {
                // Trip Over or Not Started (if dates are past)
                container.innerHTML = `
                    <div class="mt-2">
                        <h2 class="text-xl font-bold text-white">Trip Completed!</h2>
                        <p class="text-gray-400 text-sm mt-1">Hope you had a wonderful time in Vietnam.</p>
                    </div>
                `;
            }
        }

        function toggleLogistics() {
            const content = document.getElementById('logisticsContent');
            const icon = document.getElementById('logisticsIcon');
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.remove('rotate-180');
            } else {
                content.classList.add('hidden');
                icon.classList.add('rotate-180');
            }
        }

        // --- INIT ---

        window.addEventListener('DOMContentLoaded', () => {
            renderTabs(0);
            renderTimeline(0);
            updateFilterUI(); // Set initial state
            renderRecommendations();
            
            // Initial call and interval for live clock
            updateUpNext();
            setInterval(updateUpNext, 60000); // Update every minute
        });

    </script>
</body>
</html>
